<template>
  <div>Getting Data from axios</div>
</template>

<script>
import axios from "axios";

export default {
  data() {
    return {
      items: []
    };
  },
  mounted() {
    axios
      .post("https://api-test.gestionix.com/api/v3/users/authentication", {
        user: "hogar@gestionix.com",
        password: "demo"
      })
      .then(function(response) {
        let accessKey = "Bearer " + response.data.access_token;
        let urlUser = "https://api-test.gestionix.com/api/v3/users/93";
        let urlCompanie =
          "https://api-test.gestionix.com/api/v3/users/companies";
        let urlBranch =
          "https://api-test.gestionix.com/api/v3/branch_offices/?";
        localStorage.setItem("access-token", accessKey);
        axios.defaults.headers.common["Authorization"] = localStorage.getItem(
          "access-token"
        );
        axios
          .get(urlUser)
          .then(function(res) {
            // Get user data. Get n2
            console.log(res.data);
          })
          .catch(function(err) {
            console.log(err);
          });
        axios
          .get(urlCompanie)
          .then(function(resp) {
            // Get Companies data. Get n3
            console.log(resp.data);
            localStorage.setItem("company-id", resp.data[0].company_id);
            axios.defaults.headers.common["Company"] = localStorage.getItem(
              "company-id"
            );
            axios
              .get(urlBranch)
              .then(function(re) {
                // Get Branches. Get n4
                console.log(re.data);
              })
              .catch(function(err) {
                console.log(err);
              });
          })
          .catch(function(err) {
            console.log(err);
          });
      })
      .catch(function(error) {
        console.log(error);
      });
  }
};
</script>